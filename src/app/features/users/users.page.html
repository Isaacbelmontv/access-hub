<p-card>
  <ng-template pTemplate="title">
    <div class="header">
      <span class="text-xl font-bold">Gestión de Usuarios</span>
      <p-button
        icon="pi pi-refresh"
        [loading]="isLoading()"
        rounded
        raised
        (click)="getUsers()"
      ></p-button>
    </div>
  </ng-template>

  <div class="mb-4">
    <p-iconfield class="w-full">
      <p-inputicon class="pi pi-search" />
      <input
        type="text"
        pInputText
        placeholder="Buscar por nombre, email o teléfono..."
        [(ngModel)]="filter"
        class="w-full rounded"
      />
    </p-iconfield>
  </div>

  <div class="users-table">
    <p-table [value]="filtered()" dataKey="id" [tableStyle]="{ 'min-width': '50rem' }">
      <ng-template pTemplate="header">
        <tr>
          <th>Fav</th>
          <th>Nombre</th>
          <th>Email</th>
          <th>Teléfono</th>
          <th>Website</th>
          <th>Acciones</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-user>
        <tr>
          <td>
            <p-button variant="text" severity="warn" (click)="toggleFav(user.id)">
              <i
                [ngClass]="isFav(user.id) ? 'pi pi-star-fill' : 'pi pi-star'"
                [style.color]="isFav(user.id) ? '#FACC15' : '#9CA3AF'"
              ></i>
            </p-button>
          </td>

          <td>{{ user.name }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.phone | phoneMask }}</td>
          <td>{{ user.website }}</td>

          <td>
            <div class="flex items-center justify-center gap-2">
              <button
                pButton
                pRipple
                type="button"
                icon="pi pi-pencil"
                (click)="showUserDialog(user)"
                text
                rounded
                severity="secondary"
              ></button>

              <button
                pButton
                pRipple
                type="button"
                icon="pi pi-trash"
                (click)="deleteUser(user)"
                text
                rounded
                severity="secondary"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</p-card>

<app-user-dialog
  [visible]="showDialog()"
  [user]="selectedUser()"
  (save)="saveUser($event)"
  (close)="closeDialog()"
></app-user-dialog>
